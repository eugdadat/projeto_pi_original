<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Sistema de Logística e Armazenamento</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="cadastro.css">
</head>
<body>
    <nav>
        <a href="index.html">Home</a>
        <a href="login.html">Login</a>
        <a href="Cadastro.html">Cadastro</a>
        <a href="deposit.html">Depósito</a>
    </nav>
    
        <header id="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">SLA</div>
                    <h1>Sistema de <span>Logística e Armazenamento</span></h1>
                </div>
            </div>
        </div>
    </header>

    <section class="page">
        <div class="container">
            <div class="register-container">
                <div class="card">
                    <div class="register-header">
                        <div class="register-avatar">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h2 class="card-title">Criar Nova Conta</h2>
                        <p class="register-subtitle">Preencha os dados abaixo para se cadastrar</p>
                    </div>
                    
                    <form id="register-form">
                        <div class="form-group">
                            <label for="nome">Nome Completo</label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-user"></i>
                                <input type="text" id="nome" placeholder="Digite seu nome completo" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">E-mail</label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-envelope"></i>
                                <input type="email" id="email" placeholder="Digite seu e-mail" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="chapa">Número da Chapa</label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-id-card"></i>
                                <input type="text" id="chapa" placeholder="Digite seu número da chapa" required pattern="[0-9]+" title="Apenas números são permitidos">
                            </div>
                            <div class="chapa-info">
                                <i class="fas fa-info-circle"></i>
                                O número da chapa é o seu identificador único na empresa
                            </div>
                        </div>

                        <div class="user-type-selector">
                            <h3><i class="fas fa-user-tag"></i> Tipo de Usuário</h3>
                            <div class="user-type-options">
                                <div class="user-type-option selected" data-type="employee">
                                    <i class="fas fa-user"></i>
                                    <div>Funcionário</div>
                                    <small>Acesso básico</small>
                                </div>
                                <div class="user-type-option" data-type="manager">
                                    <i class="fas fa-user-tie"></i>
                                    <div>Gerente</div>
                                    <small>Acesso completo</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="senha">Senha</label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-lock"></i>
                                <input type="password" id="senha" placeholder="Digite sua senha" required minlength="6">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmar">Confirmar Senha</label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-lock"></i>
                                <input type="password" id="confirmar" placeholder="Confirme sua senha" required>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-block">
                            <i class="fas fa-user-plus"></i>
                            <span>Cadastrar</span>
                        </button>
                    </form>

                    <div id="message" class="message"></div>

                    <div class="login-link">
                        <p>Já tem uma conta? <a href="login.html">Faça login aqui</a></p>
                    </div>

                    <div style="text-align: center;">
                        <a href="index.html" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i>
                            <span>Voltar para Início</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        let selectedUserType = 'employee';

        document.addEventListener('DOMContentLoaded', function() {
            // Configurar seleção de tipo de usuário
            document.querySelectorAll('.user-type-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.user-type-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedUserType = this.getAttribute('data-type');
                    console.log('Tipo de usuário selecionado:', selectedUserType);
                });
            });

            // Configurar formulário de cadastro
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const nome = document.getElementById('nome').value;
                const email = document.getElementById('email').value;
                const chapa = document.getElementById('chapa').value;
                const senha = document.getElementById('senha').value;
                const confirmar = document.getElementById('confirmar').value;

                // Validações
                if (senha !== confirmar) {
                    showMessage('As senhas não coincidem!', 'error');
                    return;
                }

                if (senha.length < 6) {
                    showMessage('A senha deve ter pelo menos 6 caracteres!', 'error');
                    return;
                }

                if (!/^\d+$/.test(chapa)) {
                    showMessage('O número da chapa deve conter apenas números!', 'error');
                    return;
                }

                // Gerar username a partir do email
                const username = email.split('@')[0].toLowerCase();
                
                // Cadastrar usuário
                const newUser = {
                    id: Date.now(),
                    username: username,
                    password: senha,
                    type: selectedUserType,
                    name: nome,
                    email: email,
                    chapa: chapa,
                    createdAt: new Date().toISOString()
                };

                const users = JSON.parse(localStorage.getItem('system_users') || '[]');
                
                // Verificar se email já existe
                const userExists = users.find(u => u.email === email);
                if (userExists) {
                    showMessage('Este e-mail já está cadastrado!', 'error');
                    return;
                }

                // Verificar se username já existe
                const usernameExists = users.find(u => u.username === username);
                if (usernameExists) {
                    showMessage('Nome de usuário já existe! Tente outro e-mail.', 'error');
                    return;
                }

                // Verificar se número da chapa já existe
                const chapaExists = users.find(u => u.chapa === chapa);
                if (chapaExists) {
                    showMessage('Este número da chapa já está cadastrado!', 'error');
                    return;
                }

                users.push(newUser);
                localStorage.setItem('system_users', JSON.stringify(users));

                const userTypeText = selectedUserType === 'manager' ? 'GERENTE' : 'FUNCIONÁRIO';
                showMessage(`✅ Cadastro realizado com sucesso! Tipo: ${userTypeText} - Chapa: ${chapa}`, 'success');
                
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 3000);
            });
        });

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            // Rolagem suave para a mensagem
            messageDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>